# 3D-Maze

一个基于Web的3D迷宫渲染引擎，使用原生JavaScript和Canvas API实现，无需任何外部依赖。

## 项目概述

3D-Maze是一个3D图形渲染项目，能够加载和渲染3D模型（OBJ格式）和自定义迷宫地图格式。它实现了完整的3D渲染管线，包括：

- 3D模型加载和解析（支持OBJ格式）
- 自定义地图格式解析和渲染
- 透视投影和相机系统
- 深度缓冲和光照效果
- 实时相机控制（WASD移动，鼠标旋转，滚轮缩放）

## 功能特性

### 3D渲染引擎
- 基于Canvas 2D API的软件渲染
- 三角形光栅化渲染
- 深度缓冲(Z-Buffer)算法
- 透视投影变换
- 坐标系变换
- 简单光照模型（基于深度的距离衰减）

### 相机系统
- 第一人称视角控制
- 6自由度相机移动（前后、左右、上下）
- 鼠标控制视角旋转
- 滚轮缩放（焦距调整）
- 视野角(FOV)控制

### 模型支持
- OBJ文件格式加载和解析
- 自定义地图文件格式解析
- 自动面法线计算
- 顶点和面数据处理

### 控制方式
- **WASD键**：前后左右移动
- **Q/E键**：上下移动
- **鼠标拖拽**：旋转视角
- **鼠标滚轮**：缩放视角

## 项目结构
```
3D-Maze/
├── index.html # 主页面
├── index.js # 应用入口和主逻辑 
├── js/ # 核心JavaScript模块
│    ├── MathVector.js # 向量数学库
│    ├── renderer.js # 3D渲染器
│    ├── cameraController.js # 相机控制器
│    ├── objDecoder.js # OBJ文件解析器
│    ├── mapDecoder.js # 地图文件解析器 
│    └── screenAdaptor.js # 屏幕适配器 
├── models/ # 3D模型文件
│    ├── map.obj # 示例OBJ模型
│    └── test.obj # 测试模型 
├── maps/ # 地图文件
│    └── test.map # 示例地图文件
├── style/ # 样式文件
│    └── document.css # 页面样式 
└── readme.md # 项目说明文档
```


## 核心组件

### 渲染器 (Renderer)
负责3D场景的渲染，包括：
- 顶点变换和投影
- 三角形光栅化
- 深度测试
- 颜色插值和光照计算

### 相机控制器 (CameraController)
处理用户输入和相机移动：
- 键盘事件监听
- 鼠标事件处理
- 相机位置和方向更新
- 边界约束检查

### 数学向量库 (MathVector)
提供3D数学运算功能：
- 向量加减和数乘
- 点积和叉积计算
- 向量归一化
- 坐标系变换

### 模型解析器
- **OBJDecoder**：解析Wavefront OBJ文件格式
- **MapDecoder**：解析自定义地图文件格式

## 地图文件格式

地图文件使用简单的文本格式：

```
this is a map file for 3d-maze.

y2,2,2,2,2,2
y2,1,1,1,1,2
...

```

- 第一行必须为文件标识
- 每行以'y'开头，后跟逗号分隔的高度值
- 数字表示该位置的方块高度

## 使用方法

1. 克隆或下载项目到本地
2. 使用现代浏览器打开 `index.html` 文件
3. 使用WASD键移动，鼠标拖拽旋转视角，滚轮缩放

## 技术细节

### 渲染管线
1. 模型数据加载（OBJ或地图文件）
2. 顶点坐标变换（世界坐标→相机坐标）
3. 透视投影（相机坐标→屏幕坐标）
4. 三角形光栅化
5. 深度测试和颜色计算
6. Canvas 2D上下文绘制

### 坐标系统
- 使用右手坐标系
- X轴：右方向
- Y轴：前方向
- Z轴：上方向

## 开发说明

### 添加新模型
1. 将OBJ文件放入 `models/` 目录
2. 修改 `index.js` 中的加载路径

### 自定义地图
1. 创建符合格式的 `.map` 文件
2. 放入 `maps/` 目录
3. 修改 `index.js` 中的加载路径

### 调整相机参数
在 `index.js` 中修改相机对象：
```javascript
const camera = {
    position: [3, 3, 3],    // 相机位置
    direction: [-1, -1, -1], // 相机朝向
    focus: 1,               // 焦距
    fov: Math.PI / 4        // 视野角
}

```
